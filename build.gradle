plugins {
    id 'org.hidetake.swagger.generator' version '2.19.2'
    id 'groovy-base'
}

apply plugin: 'org.hidetake.swagger.generator'

repositories {
    mavenCentral()
    maven { url 'https://repo.spring.io/release' }
}

dependencies {
    swaggerCodegen 'org.openapitools:openapi-generator-cli:7.0.0'
}

defaultTasks 'clean', 'generateSwaggerCode'

// The following are at least relatively unique to the zeus project
task swaggerClean(type: Delete) {
    doFirst {
        delete generatedApiDirectory
    }
}

task generate(type: Delete) {
    doFirst {
        delete generatedApiDirectory + '/server/docs'
        delete generatedApiDirectory + '/server/test'
    }
}
swaggerClean.mustRunAfter(clean)
generateSwaggerCode.dependsOn(swaggerClean)
generateSwaggerCode.mustRunAfter(swaggerClean)
generate.dependsOn(generateSwaggerCode)
generate.mustRunAfter(generateSwaggerCode)

swaggerSources {
    mvp {
        inputFile = file("swagger_server/swagger/ta1.yaml")
        code {
            language = 'python'
            components = ['models']
            outputDir = file (generatedApiDirectory)
            configFile = file (apiDirectory+'/config.json')
            wipeOutputDir = true
        }
    }
    server {
        inputFile = file("swagger_server/swagger/swagger.yaml")
        code {
            language = 'python'
            components = ['models','apis']
            outputDir = file (generatedApiDirectory)
            configFile = file (apiDirectory+'/config.json')
        }
    }

    doLast {
        copy {
            from generatedApiDirectory+'/openapi_client/'
            into 'swagger_server/'
        }
        // delete generatedApiDirectory
    }
}