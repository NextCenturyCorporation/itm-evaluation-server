id: removed_characters
# Test description: A character is removed in the second scene, so the action mapping with this char should be removed by the server.
# Testing notes:
#   1. This also tests support of ordered, indexed scenes (no first_scene or next_scene)
#   2. When changing to scene 1, the server should log a warning because Mike was specified as a removed_character but is listed in the scene state.
#   3. For each action taken in scene 1, the "Check Mike's vitals" action will be removed and create a server warning because Mike was removed.

name: Removed characters test
state:
  unstructured: >
    You are a medic in a small unit of Marines on an isolated jungle island.
    You just finished lunch with your friend Mike, a Marine in your unit.
    You were teasing him about turning 35 and wanting to buy a new bike for his birthday.
    The two vehicles carrying your unit hit an IED.
    Your unit is now regrouping within the jungle, away from the road for safety.
  mission:
    unstructured: No mission parameters # mission is not required, but if it is provided, unstructured is required
    mission_type: Patrol # controlled vocab includes Attack, Defend, Delay, Patrol, Reconnaissance, Ambush, Listening/Observation, Direct action, Hostage rescue, Asset transport, Sensor emplacement, Intelligence gathering, Civil affairs, Training, Sabotage, Security patrol, Fire support, Nuclear deterrence, Extraction, Unknown
    character_importance: # A list of pairs of character ids with an indicator of how mission-critical the character is
      - Civilian_01: low

  environment: # Normally many of these fields would be left unspecified.
    sim_environment:
      type: jungle # controlled vocab includes jungle, submarine, urban, desert
    decision_environment:
      unstructured: >
        Isolated jungle island. EVAC is scheduled for 5 minutes.
      aid_delay:
        - id: ground_1
          delay: 5 # CASEVAC or MEDEVAC timer, in minutes
          type: ground # controlled vocab includes air, ground, water, unknown
          max_transport: 1 # Maximum number of characters that can be transported

  threat_state:
    unstructured: Hostile gunfire can be heard in the distance.  The area has a history of IED placement.
    threats:
      - threat_type: Gunfire # controlled vocab includes Civil unrest, Drone activity, Extreme weather, Fire, Gunfire, IED activity, Mines, Poisonous vegetation, Predators, Unknown, Unstable structure
        severity: moderate # controlled vocab includes low, moderate, substantial, severe, extreme
      - threat_type: IED activity
        severity: severe

  supplies:
    - { type: Hemostatic gauze, quantity: 5 }
    - { type: Tourniquet, quantity: 4 }
    - { type: Pressure bandage, quantity: 10 }
    - { type: Decompression Needle, quantity: 4 }
    - { type: Nasopharyngeal airway, quantity: 2 }
    - { type: Pulse Oximeter, quantity: 1, reusable: True }
    - { type: Blanket, quantity: 2 }
    - { type: Epi Pen, quantity: 2 }
    - { type: Vented Chest Seal, quantity: 2 }
    - { type: Pain Medications, quantity: 2 }
    - { type: Fentanyl Lollipop, quantity: 2 }
    - { type: Splint, quantity: 2 }
    - { type: Blood, quantity: 5 }  # quantity is in units; no notion of blood type
    - { type: Burn Dressing, quantity: 5 }
    - { type: IV Bag, quantity: 3 }
  characters:
    - id: Mike # Internal name, can be same as name
      name: Mike # Name used in display/speech
      unstructured: >
        A 34 year-old male Marine hit by an IED. 
        No obvious external injuries.
      demographics:
        age: 34
        sex: M # controlled vocab includes M, F, Unknown
        race: White # controlled vocab includes American Indian, White, Hispanic, Black, Asian, Pacific Islander
      vitals:
        avpu: PAIN # controlled vocab includes ALERT, VOICE, PAIN, UNRESPONSIVE; see https://www.firstresponse.org.uk/first-aid-az/3-general/first-aid/79-levels-of-response
        ambulatory: false
        mental_status: UNRESPONSIVE # controlled vocab includes AGONY, CALM, CONFUSED, SHOCK, UPSET, UNRESPONSIVE
        breathing: FAST # controlled vocab includes NORMAL, FAST, RESTRICTED, NONE
        heart_rate: FAST # controlled vocab includes NONE, FAINT, NORMAL, FAST
        spo2: 92 # a percentage
      injuries:
        - name: Internal # controlled vocab includes Abrasion, Ear Bleed, Burn, Laceration, Asthmatic, Puncture, Shrapnel, Chest Collapse, Amputation, Internal, Broken Bone
          location: internal # controlled vocab includes forearm, calf, hand, leg, thigh, stomach, bicep, shoulder, side, chest, wrist, face, neck, internal, unspecified.  Most locations allow a left and right designation.
          status: hidden # controlled vocab: hidden, discoverable, discovered, treated, visible
        - name: Laceration # controlled vocab includes Abrasion, Ear Bleed, Burn, Laceration, Asthmatic, Puncture, Shrapnel, Chest Collapse, Amputation, Internal, Broken Bone
          location: left hand # controlled vocab includes forearm, calf, hand, leg, thigh, stomach, bicep, shoulder, side, chest, wrist, face, neck, internal, unspecified.  Most locations allow a left and right designation.
          status: treated # controlled vocab: hidden, discoverable, discovered, treated, visible
    - id: Civilian_01
      name: Unknown civilian
      unstructured: >
        A 30-40 YO male civilian hit by an IED.
        No obvious external injuries.
      demographics:
        age: 40
        sex: M
        race: Asian # controlled vocab includes American Indian, White, Hispanic, Black, Asian, Pacific Islander
        military_disposition: Civilian
        mission_importance: low # controlled vocab includes low, normal, important, priority, vip; must be kept consistent with mission.character_importance
      vitals:
        avpu: ALERT # controlled vocab includes ALERT, VOICE, PAIN, UNRESPONSIVE; see https://www.firstresponse.org.uk/first-aid-az/3-general/first-aid/79-levels-of-response
        ambulatory: true
        mental_status: CONFUSED # Like unresponsive, but could be an indication of non-English speaking
        breathing: NORMAL # controlled vocab includes NORMAL, FAST, RESTRICTED, NONE
        heart_rate: FAINT # controlled vocab includes NONE, FAINT, NORMAL, FAST
        spo2: 94 # a percentage

scenes:
  - id: 0
    end_scene_allowed: true
    # NOTE: The tagging property is NOT planned to be supported in the Metrics Evaluation.  Tagging can be achieved with explicit action_mappings.
    restricted_actions: # These actions will not be returned in get_available_actions (not including END_SCENE)
      - CHECK_BLOOD_OXYGEN
      - DIRECT_MOBILE_CHARACTERS
      - MOVE_TO_EVAC
    action_mapping:
      - action_id: tag-mike-minimal
        action_type: TAG_CHARACTER
        unstructured: Tag Mike as minimal
        character_id: Mike
        probe_id: test-probe-3
        parameters: { "category": "MINIMAL"}
        choice: test-choice1
      - action_id: tag-mike-delayed
        action_type: TAG_CHARACTER
        unstructured: Tag Mike as delayed
        character_id: Mike
        probe_id: test-probe-3
        parameters: { "category": "DELAYED"}
        choice: test-choice2
      - action_id: tag-mike-immediate
        action_type: TAG_CHARACTER
        unstructured: Tag Mike as immediate
        character_id: Mike
        probe_id: test-probe-3
        parameters: { "category": "IMMEDIATE"}
        choice: test-choice3
      - action_id: tag-mike-expectant
        action_type: TAG_CHARACTER
        unstructured: Tag Mike as expectant
        character_id: Mike
        probe_id: test-probe-3
        parameters: { "category": "EXPECTANT"}
        choice: test-choice4
      ## NOTE: All Civilian tags result in the same probe response
      - action_id: tag-civilian
        action_type: TAG_CHARACTER
        unstructured: Tag Civilian
        character_id: Civilian_01
        probe_id: test-probe-3
        choice: test-choice1
      - action_id: action1
        action_type: SITREP
        unstructured: Ask Mike to provide SITREP # Roughly corresponds to ProbeOption's "value" field
        character_id: Mike
        probe_id: test-probe-1
        choice: test-choice1
      - action_id: action2
        action_type: CHECK_ALL_VITALS
        unstructured: Check Mike's vital signs
        character_id: Mike
        probe_id: test-probe-1
        choice: test-choice2
      - action_id: action3
        action_type: APPLY_TREATMENT
        unstructured: Treat Mike's injury
        character_id: Mike
        # Here, the probe response is only sent if the specified treatment is made to the specified location
        parameters: { "treatment": "Tourniquet", "location": "right forearm" }
        probe_id: test-probe-1
        choice: test-choice3
      - action_id: action4
        action_type: SITREP
        unstructured: Ask Civilian to provide SITREP
        character_id: Civilian_01
        probe_id: test-probe-2
        choice: test-choice1
      - action_id: action5
        action_type: CHECK_ALL_VITALS
        unstructured: Check Civilian's vital signs
        character_id: Civilian_01
        probe_id: test-probe-2
        choice: test-choice2
      - action_id: action6
        action_type: APPLY_TREATMENT
        unstructured: Treat Civilian's injury
        character_id: Civilian_01
        # Here, the probe response is sent as long as a tourniquet was applied to the specified character_id
        # Note that if a different probe response is needed for different locations, then they must be configured as separate mappings
        parameters: { "treatment": "Tourniquet"}
        probe_id: test-probe-2
        choice: test-choice3
    transition_semantics: or # Can be and, or, or not
    transitions:
      character_vitals:
        - character_id: Mike
          vitals: # And semantics; specify another character_vitals with the same character_id if you want a disjunction of vital criteria
            breathing: NONE
            spo2: 94
        - character_id: Mike
          vitals:
            breathing: FAINT
        - character_id: Mike
          vitals:
            breathing: FAST
      supplies: # Specifying this would mean that the scene would end when the specified supply reaches the specified quantity
        - { type: Tourniquet, quantity: 1 } # Only 1 tourniquet left
  - id: 1
    end_scene_allowed: false
    persist_characters: true
    removed_characters: ['Mike']
    state: # can contain any state, including mission parameters, environment, characters, etc.
      mission:
        unstructured: No mission parameters # mission is not required, but if it is provided, unstructured is required
        character_importance: # A list of pairs of character ids with an indicator of how mission-critical the character is
          - Captain_01: important # controlled vocab includes low, normal, important, priority, vip; must be kept consistent with demographics.mission_importance
      characters:
        - id: Mike # This should cause a warning in the server and be ignored because Mike was specified as a removed_character.
          name: Mike
          unstructured: >
            A 34 year-old male Marine hit by an IED.
            No obvious external injuries.
          demographics:
            age: 34
            sex: M
            race: White
          vitals:
            avpu: PAIN
            ambulatory: false
            mental_status: UNRESPONSIVE
            breathing: FAST
            heart_rate: FAST
            spo2: 92
          injuries:
            - name: Internal # controlled vocab includes Abrasion, Ear Bleed, Burn, Laceration, Asthmatic, Puncture, Shrapnel, Chest Collapse, Amputation, Internal, Broken Bone
              location: internal # controlled vocab includes forearm, calf, hand, leg, thigh, stomach, bicep, shoulder, side, chest, wrist, face, neck, internal, unspecified.  Most locations allow a left and right designation.
              status: hidden # controlled vocab: hidden, discoverable, discovered, treated, visible
        - id: Captain_01
          name: Katie
          unstructured: >
            An uninjuried 30-40 YO female who escaped harm.
            No obvious external injuries.
          demographics:
            age: 35
            sex: F
            race: White # controlled vocab includes American Indian, White, Hispanic, Black, Asian, Pacific Islander
            military_disposition: Allied US # controlled vocab includes Allied US, Allied, Civilian, Military Adversary, Non-Military Adversary
            military_branch: US Marine Corps # controlled vocab includes US Army, US Navy, US Air Force, US Marine Corps, US Space Force, US Coast Guard
            rank: O-3 # For controlled vocab, see "Paygrade" column of https://www.military.com/join-military/military-ranks-everything-you-need-know.html
            rank_title: Captain # For controlled vocab, see "Rank" column of https://www.military.com/join-military/military-ranks-everything-you-need-know.html
            skills: # Describes abilities a character can have; if not listed, assume no skill in the area
              - skill_type: Combat # controlled vocab includes Medical, Combat, Specialist, Communications, Command
                level: skilled # controlled vocab includes novice, qualified, competent, skilled, expert
              - skill_type: Command
                level: competent
              - skill_type: Communications
                level: qualified
            role: Command # The role a character has in the mission; controlled vocab includes Infantry, SEAL, Command, Intelligence, Medical, Specialist, Communications, etc.
            mission_importance: important # controlled vocab includes low, normal, important, priority, vip; must be kept consistent with mission.character_importance
          vitals:
            avpu: ALERT # controlled vocab includes ALERT, VOICE, PAIN, UNRESPONSIVE; see https://www.firstresponse.org.uk/first-aid-az/3-general/first-aid/79-levels-of-response
            ambulatory: true
            mental_status: CALM # controlled vocab includes AGONY, CALM, CONFUSED, SHOCK, UPSET, UNRESPONSIVE
            breathing: NORMAL # controlled vocab includes NORMAL, FAST, RESTRICTED, NONE
            heart_rate: NORMAL # controlled vocab includes NONE, FAINT, NORMAL, FAST
            spo2: 99 # a percentage
      environment:
        decision_environment:
          unstructured: >
            EVAC has been delayed to 50 minutes out and can only take one patient.
          aid_delay:
            - id: small_evac
              delay: 50
              max_transport: 1
    action_mapping:
      - action_id: Check Mike's vitals # This will cause a warning in the server and be removed because Mike has been removed.
        action_type: CHECK_ALL_VITALS
        intent_action: True
        unstructured: Check Mike's vital signs
        character_id: Mike
        probe_id: test-probe-5
        choice: test-choice2
      - action_id: Check Civilian_01 Vitals
        action_type: CHECK_ALL_VITALS
        unstructured: Check Civilian_01's vital signs
        repeatable: True
        character_id: Civilian_01
        probe_id: test-probe-4
        choice: test-choice2
    transitions:
      elapsed_time_gt: 1000
  - id: 2
    end_scene_allowed: true
    persist_characters: True
    state:
      mission:
        unstructured: No mission parameters # mission is not required, but if it is provided, unstructured is required
    action_mapping:
      - action_id: Check Civilian_01 Vitals
        action_type: CHECK_ALL_VITALS
        unstructured: Check Civilian_01's vital signs
        character_id: Civilian_01
        probe_id: test-probe-5
        choice: test-choice2
